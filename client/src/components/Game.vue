<script setup lang="ts">
import { computed, onMounted, onUnmounted, ref } from 'vue'
import { io, Socket } from "socket.io-client"

const props = defineProps<{
  gameId: string
}>()

let socket: Socket
const connected = ref(false)

const board: { [key in string]: string[] } = {
  //       RGT    LFT    RGTDWN     LFTDWN     DWN    RGTUP      LFTUP      UP
  "0,0": ["1,0",        "0.5,0.5",            "0,1"                             ],
  "1,0": ["2,0", "0,0", "1.5,0.5", "0.5,0.5", "1,1"                             ],
  "2,0": ["3,0", "1.0", "2.5,0.5", "1.5,0.5", "2,1"                             ],
  "3,0": ["4,0", "2,0", "3.5,0.5", "2.5,0.5", "3,1"                             ],
  "4,0": ["5,0", "3,0", "4.5,0.5", "3.5,0.5", "4,1"                             ],
  "5,0": [       "4,0",            "4.5,0.5", "5,1"                             ],

  "0,1": ["1,1",        "0.5,1.5",            "0,2", "0.5,0.5",            "0,0"],
  "1,1": ["2,1", "0,1", "1.5,1.5", "0.5,1.5", "1,2", "1.5,0.5", "0.5,0.5", "1,0"],
  "2,1": ["3,1", "1,1", "2.5,1.5", "1.5,1.5", "2,2", "2.5,0.5", "1.5,0.5", "2,0"],
  "3,1": ["4,1", "2,1", "3.5,1.5", "2.5,1.5", "3,2", "3.5,0.5", "2.5,0.5", "3,0"],
  "4,1": ["5,1", "3,1", "4.5,1.5", "3.5,1.5", "4,2", "4.5,0.5", "3.5,0.5", "4,0"],
  "5,1": [       "4,1",            "4.5,1.5", "5,2",            "4.5,0.5", "5,0"],

  "0,2": ["1,2",        "0.5,2.5",            "0,3", "0.5,1.5",            "0,1"],
  "1,2": ["2,2", "0,2", "1.5,2.5", "0.5,2.5", "1,3", "1.5,1.5", "0.5,1.5", "1,1"],
  "2,2": ["3,2", "1,2", "2.5,2.5", "1.5,2.5", "2,3", "2.5,1.5", "1.5,1.5", "2,1"],
  "3,2": ["4,2", "2,2", "3.5,2.5", "2.5,2.5", "3,3", "3.5,1.5", "2.5,1.5", "3,1"],
  "4,2": ["5,2", "3,2", "4.5,2.5", "3.5,2.5", "4,3", "4.5,1.5", "3.5,1.5", "4,1"],
  "5,2": [       "4,2",            "4.5,2.5", "5,3",            "4.5,1.5", "5,1"],

  "0,3": ["1,3",        "0.5,3.5",            "0,4", "0.5,2.5",            "0,2"],
  "1,3": ["2,3", "0,3", "1.5,3.5", "0.5,3.5", "1,4", "1.5,2.5", "0.5,2.5", "1,2"],
  "2,3": ["3,3", "1,3", "2.5,3.5", "1.5,3.5", "2,4", "2.5,2.5", "1.5,2.5", "2,2"],
  "3,3": ["4,3", "2,3", "3.5,3.5", "2.5,3.5", "3,4", "3.5,2.5", "2.5,2.5", "3,2"],
  "4,3": ["5,3", "3,3", "4.5,3.5", "3.5,3.5", "4,4", "4.5,2.5", "3.5,2.5", "4,2"],
  "5,3": [       "4,3",            "4.5,3.5", "5,4",            "4.5,2.5", "5,2"],

  "0,4": ["1,4",        "0.5,4.5",            "0,5", "0.5,3.5",            "0,3"],
  "1,4": ["2,4", "0,4", "1.5,4.5", "0.5,4.5", "1,5", "1.5,3.5", "0.5,3.5", "1,3"],
  "2,4": ["3,4", "1,4", "2.5,4.5", "1.5,4.5", "2,5", "2.5,3.5", "1.5,3.5", "2,3"],
  "3,4": ["4,4", "2,4", "3.5,4.5", "2.5,4.5", "3,5", "3.5,3.5", "2.5,3.5", "3,3"],
  "4,4": ["5,4", "3,4", "4.5,4.5", "3.5,4.5", "4,5", "4.5,3.5", "3.5,3.5", "4,3"],
  "5,4": [       "4,4",            "4.5,4.5", "5,5",            "4.5,3.5", "5,3"],

  "0,5": ["1,5",        "0.5,5.5",            "0,6", "0.5,4.5",            "0,4"],
  "1,5": ["2,5", "0,5", "1.5,5.5", "0.5,5.5", "1,6", "1.5,4.5", "0.5,4.5", "1,4"],
  "2,5": ["3,5", "1,5", "2.5,5.5", "1.5,5.5", "2,6", "2.5,4.5", "1.5,4.5", "2,4"],
  "3,5": ["4,5", "2,5", "3.5,5.5", "2.5,5.5", "3,6", "3.5,4.5", "2.5,4.5", "3,4"],
  "4,5": ["5,5", "3,5", "4.5,5.5", "3.5,5.5", "4,6", "4.5,4.5", "3.5,4.5", "4,4"],
  "5,5": [       "4,5",            "4.5,5.5", "5,6",            "4.5,4.5", "5,4"],

  "0,6": ["1,6",                                     "0.5,5.5",            "0,5"],
  "1,6": ["2,6", "0,6",                              "1.5,5.5", "0.5,5.5", "1,5"],
  "2,6": ["3,6", "1,6",                              "2.5,5.5", "1.5,5.5", "2,5"],
  "3,6": ["4,6", "2,6",                              "3.5,5.5", "2.5,5.5", "3,5"],
  "4,6": ["5,6", "3,6",                              "4.5,5.5", "3.5,5.5", "4,5"],
  "5,6": [       "4,6",                                         "4.5,5.5", "5,5"],


  "0.5, 0.5": [         "1,1",     "0,1",            "1,0",     "0,0"           ],
  "1.5, 0.5": [         "2,1",     "1,1",            "2,0",     "1,0"           ],
  "2.5, 0.5": [         "3,1",     "2,1",            "3,0",     "2,0"           ],
  "3.5, 0.5": [         "4,1",     "3,1",            "4,0",     "3,0"           ],
  "4.5, 0.5": [         "5,1",     "4,1",            "5,0",     "4,0"           ],

  "0.5, 1.5": [         "1,2",     "0,2",            "1,1",     "0,1"           ],
  "1.5, 1.5": [         "2,2",     "1,2",            "2,1",     "1,1"           ],
  "2.5, 1.5": [         "3,2",     "2,2",            "3,1",     "2,1"           ],
  "3.5, 1.5": [         "4,2",     "3,2",            "4,1",     "3,1"           ],
  "4.5, 1.5": [         "5,2",     "4,2",            "5,1",     "4,1"           ],

  "0.5, 2.5": [         "1,3",     "0,3",            "1,2",     "0,2"           ],
  "1.5, 2.5": [         "2,3",     "1,3",            "2,2",     "1,2"           ],
  "2.5, 2.5": [         "3,3",     "2,3",            "3,2",     "2,2"           ],
  "3.5, 2.5": [         "4,3",     "3,3",            "4,2",     "3,2"           ],
  "4.5, 2.5": [         "5,3",     "4,3",            "5,2",     "4,2"           ],

  "0.5, 3.5": [         "1,4",     "0,4",            "1,3",     "0,3"           ],
  "1.5, 3.5": [         "2,4",     "1,4",            "2,3",     "1,3"           ],
  "2.5, 3.5": [         "3,4",     "2,4",            "3,3",     "2,3"           ],
  "3.5, 3.5": [         "4,4",     "3,4",            "4,3",     "3,3"           ],
  "4.5, 3.5": [         "5,4",     "4,4",            "5,3",     "4,3"           ],

  "0.5, 4.5": [         "1,5",     "0,5",            "1,4",     "0,4"           ],
  "1.5, 4.5": [         "2,5",     "1,5",            "2,4",     "1,4"           ],
  "2.5, 4.5": [         "3,5",     "2,5",            "3,4",     "2,4"           ],
  "3.5, 4.5": [         "4,5",     "3,5",            "4,4",     "3,4"           ],
  "4.5, 4.5": [         "5,5",     "4,5",            "5,4",     "4,4"           ],

  "0.5, 5.5": [         "1,6",     "0,6",            "1,5",     "0,5"           ],
  "1.5, 5.5": [         "2,6",     "1,6",            "2,5",     "1,5"           ],
  "2.5, 5.5": [         "3,6",     "2,6",            "3,5",     "2,5"           ],
  "3.5, 5.5": [         "4,6",     "3,6",            "4,5",     "3,5"           ],
  "4.5, 5.5": [         "5,6",     "4,6",            "5,5",     "4,5"           ],
}

const coordinates = Object.keys(board).map(e => {
    const [sx, sy] = e.split(",")
    return [Number.parseFloat(sx), Number.parseFloat(sy)]
  })

const links = Object.keys(board).reduce<number[][][]>((links, key) => {
    const [sx, sy] = key.split(",")
    const [nx, ny] = [Number.parseFloat(sx), Number.parseFloat(sy)]
    
    board[key].forEach(next => {
      const [nsx, nsy] = next.split(",")
      const [nnx, nny] = [Number.parseFloat(nsx), Number.parseFloat(nsy)]

      if (nx <= nnx || ny <= nny) {
        links.push([[nx, ny], [nnx, nny]])
      }
    }, [])

    return links
  }, [])

const boardWidth = 600
const boardHeight = (boardWidth/6) * 6
const scale = 50
const pointRadius = 10

onMounted(() => {
  socket = io("http://localhost:4000/game")

  socket.on("connect", () => {
    connected.value = true
  })
  socket.on("disconnect", () => {
    connected.value = false
  })

  socket.emit("join", { gameId: props.gameId })
})

onUnmounted(() => {
  socket.disconnect()
})
</script>

<template>
  <p v-if="connected">Online</p>
  <p v-else>Disconnected</p>

  <svg :width="boardWidth" :height="boardHeight">
    <g
      :transform="`translate(${pointRadius}, ${pointRadius})`"
    >
      <circle
        v-for="coordinate in coordinates"
        :cx = "coordinate[0] * scale"
        :cy = "coordinate[1] * scale"
        r="10"
        fill="hsla(160, 100%, 37%, 1)"
      ></circle>
      <line
        v-for="link in links"
        :x1="link[0][0] * scale"
        :y1="link[0][1] * scale"
        :x2="link[1][0] * scale"
        :y2="link[1][1] * scale"
        stroke="hsla(160, 100%, 37%, 1)"
        stroke-width="4"
      ></line>
    </g>
  </svg>
</template>

<style scoped>

</style>
